# WhatsApp AI Dental Clinic Assistant & Multimedia Processor

This n8n workflow demonstrates an advanced AI-powered assistant for a dental clinic, interacting with users via WhatsApp. It can handle various message types including text, audio, video, and images, process them using AI models (OpenAI and Google Gemini), and manage appointments by integrating with Google Calendar, Google Sheets, and Gmail.

## Purpose & Goals

The primary goal of this workflow is to automate initial patient interactions for a dental clinic, including:
* Responding to inquiries via WhatsApp.
* Understanding user requests from text, voice notes, images, or videos.
* Collecting patient information.
* Assisting with appointment booking based on availability in Google Calendar.
* Handling emergency requests.
* Storing interaction details and appointments in Google Sheets.
* Sending confirmation emails via Gmail.

## Key Features

* **WhatsApp Integration:** Triggers on incoming WhatsApp messages.
* **Multimedia Handling:**
    * **Audio:** Downloads and transcribes audio messages/voice notes (using OpenAI Whisper or Google Gemini).
    * **Video:** Downloads videos and uses Google Gemini to understand their content.
    * **Images:** Downloads images and uses a multimodal LLM (like GPT-4o via Google Gemini Chat Model) to analyze their content.
* **AI-Powered Conversation:** Utilizes a Langchain AI Agent with a detailed system prompt to act as a friendly and efficient dental clinic assistant.
* **Tool Integration:** The AI Agent is equipped with tools to interact with:
    * Google Calendar (create, read, delete events)
    * Google Sheets (add, update, read rows for patient data and appointments)
    * Gmail (send confirmation emails)
* **Conversational Memory:** Maintains a history of the conversation for context-aware responses.
* **Multi-Language Support:** The AI agent is configured to communicate in English, Italian, and Spanish.
* **Structured Information Flow:** Follows a specific logic for collecting user information and offering appointments.

## Workflow Breakdown

The workflow operates in several key stages:

1.  **Message Reception (WhatsApp Trigger):**
    * The workflow starts when a new message is received on the configured WhatsApp number.
    * Messages are split into their constituent parts.

2.  **Message Type Routing (Switch Node - "Redirect Message Types"):**
    * A Switch node determines the type of incoming message (text, audio, video, or image).
    * The workflow then branches to the appropriate processing path.

3.  **Media Processing & Content Extraction:**
    * **Audio Messages:**
        * The audio file URL is retrieved from WhatsApp.
        * The audio is downloaded.
        * The downloaded audio is sent to OpenAI (Whisper) or Google Gemini for transcription.
        * The transcribed text is prepared for the AI Agent.
    * **Video Messages:**
        * The video file URL is retrieved.
        * The video is downloaded.
        * The video binary data is sent to Google Gemini (via HTTP Request) with a prompt to describe the video content.
        * The description is formatted for the AI Agent.
    * **Image Messages:**
        * The image file URL is retrieved.
        * The image is downloaded.
        * The image is processed by a multimodal LLM ("Image Explainer" using Google Gemini Chat Model) to describe its content and transcribe any visible text.
        * The explanation is prepared for the AI Agent.
    * **Text Messages:**
        * Text messages are passed through, potentially for summarization or direct use by the AI agent.

4.  **Data Aggregation (Set Node - "Get User's Message"):**
    * Information from the original message (like sender ID) and the processed content (transcribed audio, video/image descriptions, or original text) are consolidated.

5.  **AI Agent Interaction (Langchain AI Agent - "AI Agent"):**
    * The consolidated user message/query is passed to the Langchain AI Agent.
    * **System Prompt:** The agent is primed with a detailed system message defining its role as a "helpful AI assistant for a Dental Clinic," its language capabilities, available tools, and a strict task flow for handling appointment booking, information gathering, and emergency scenarios.
    * **Tools:** The agent uses the connected Google Calendar, Google Sheets, and Gmail tools to perform actions based on the conversation (e.g., check availability, book appointments, save data, send emails).
    * **Memory:** A "Window Buffer Memory" node provides conversational history to the agent.

6.  **Response to User (WhatsApp Node - "Respond to User"):**
    * The output generated by the AI Agent (e.g., a question, a confirmation, available slots) is sent back to the user via WhatsApp.

## Key Nodes Used

* **WhatsApp Trigger:** Initiates the workflow on new messages.
* **Split Out:** Processes incoming message arrays.
* **Switch:** Routes flow based on message type.
* **WhatsApp (Get Media URL):** Retrieves URLs for media files.
* **HTTP Request:** Downloads media files from WhatsApp URLs; sends data to Google Gemini for video/audio processing.
* **OpenAI Node (Transcribe):** Transcribes audio using OpenAI Whisper.
* **Langchain LLM/ChatModel Nodes (Image Explainer, Google Gemini Chat Model, OpenAI Chat Model):** Provides language model capabilities for image analysis and as part of the AI Agent.
* **Langchain AI Agent:** The core conversational AI logic unit.
* **Langchain Window Buffer Memory:** Stores conversation history.
* **Set Node:** Structures and prepares data for different steps.
* **Google Calendar Tool, Google Sheets Tool, Gmail Tool:** Allow the AI Agent to interact with Google services.
* **WhatsApp (Send Message):** Sends replies back to the user.

## External Services & APIs Utilized

* WhatsApp Business API
* OpenAI API (for audio transcription and potentially chat models)
* Google Gemini API (for video/audio processing and chat models)
* Google Calendar API
* Google Sheets API
* Gmail API

## Setup Considerations (for context)

To replicate or understand this workflow fully, one would typically need:

* A configured n8n instance.
* Valid credentials for WhatsApp Business API, OpenAI, Google Cloud Platform (for Gemini, Calendar, Sheets, Gmail).
* Specific Google Sheet ID and Google Calendar ID for the dental clinic.
* The detailed system prompt used for the AI Agent.

## Workflow Screenshot

![Image](https://github.com/user-attachments/assets/ab737208-fc73-4110-bcff-63536d2fef7a)
